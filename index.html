<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Escape de Meteoritos - Videojuego sencillo en JavaScript</title>
  <meta name="description" content="Videojuego sencillo hecho en HTML5 Canvas y JavaScript. Esquiva los meteoritos y supera el récord.">
  <style>
    :root {
      color-scheme: dark;
      --bg: radial-gradient(circle at top, #141934, #05060d 65%);
      --panel: rgba(12, 15, 30, 0.82);
      --accent: #5be9ff;
      --accent-strong: #00c2ff;
      --text: #f5f6fb;
      --muted: #9ca7c6;
      --radius: 18px;
      --shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: var(--bg);
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text);
      padding: 32px 16px;
    }
    .card {
      width: min(720px, 100%);
      background: var(--panel);
      padding: 28px clamp(18px, 4vw, 34px) 34px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    h1 {
      margin: 0 0 4px;
      font-size: clamp(30px, 5vw, 42px);
      letter-spacing: 0.4px;
    }
    .desc {
      margin: 0 0 24px;
      color: var(--muted);
      font-size: 17px;
      line-height: 1.6;
    }
    canvas {
      width: 100%;
      max-width: 640px;
      aspect-ratio: 5 / 6;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: inset 0 0 12px rgba(91, 233, 255, 0.16);
      background: rgba(4, 7, 17, 0.92);
      display: block;
      margin: 0 auto;
    }
    .ui {
      margin: 22px 0 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
    }
    button {
      padding: 12px 22px;
      border-radius: 999px;
      border: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #031b21;
      font-weight: 700;
      letter-spacing: 0.3px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 12px 25px rgba(91, 233, 255, 0.25);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
    }
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 24px;
      font-size: 15px;
    }
    .stats span {
      color: var(--muted);
    }
    .stats strong {
      color: var(--text);
    }
    .help {
      margin-top: 10px;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
    }
    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(5, 9, 20, 0.7);
      backdrop-filter: blur(6px);
      text-align: center;
      padding: 20px;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .overlay.is-visible {
      visibility: visible;
      opacity: 1;
    }
    .overlay__panel {
      background: rgba(7, 13, 32, 0.9);
      border-radius: 20px;
      padding: 26px 28px 28px;
      box-shadow: var(--shadow);
      max-width: 340px;
    }
    .overlay h2 {
      margin: 0 0 12px;
      font-size: 26px;
    }
    .overlay p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <main class="card" aria-labelledby="titulo">
    <h1 id="titulo">Escape de Meteoritos</h1>
    <p class="desc">Un videojuego arcade muy sencillo hecho con <strong>HTML5 Canvas</strong> y <strong>JavaScript</strong>. Mueve la nave con las flechas para esquivar los meteoritos todo el tiempo posible.</p>
    <canvas id="game" width="480" height="576" role="img" aria-label="Área de juego"></canvas>
    <div class="ui">
      <button id="btnStart" type="button">Iniciar partida</button>
      <div class="stats" aria-live="polite">
        <span>Puntuación: <strong id="score">0</strong></span>
        <span>Vidas: <strong id="lives">3</strong></span>
        <span>Nivel: <strong id="level">1</strong></span>
      </div>
    </div>
    <p class="help">Controles: flecha izquierda ⬅️ y flecha derecha ➡️. El nivel sube automáticamente y los meteoritos caen más deprisa. ¿Cuánto aguantas?</p>
    <section class="overlay" id="overlay" aria-live="assertive" aria-hidden="true">
      <div class="overlay__panel">
        <h2 id="overlayTitle">¡Listo para despegar!</h2>
        <p id="overlayText">Pulsa el botón «Iniciar partida» para comenzar.</p>
      </div>
    </section>
  </main>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const btnStart = document.getElementById('btnStart');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const levelEl = document.getElementById('level');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayText = document.getElementById('overlayText');

    const player = {
      width: 46,
      height: 24,
      x: canvas.width / 2 - 23,
      y: canvas.height - 60,
      speed: 280,
      color: '#5be9ff'
    };

    const keys = {
      ArrowLeft: false,
      ArrowRight: false
    };

    let obstacles = [];
    let particles = [];
    let score = 0;
    let lives = 3;
    let level = 1;
    let lastTime = 0;
    let spawnTimer = 0;
    let running = false;

    const STAR_COUNT = 42;

    function initStars() {
      particles = Array.from({ length: STAR_COUNT }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.2 + 0.4,
        speed: Math.random() * 35 + 15
      }));
    }

    function resetGame() {
      player.x = canvas.width / 2 - player.width / 2;
      obstacles = [];
      score = 0;
      lives = 3;
      level = 1;
      lastTime = 0;
      spawnTimer = 0;
      updateHud();
      initStars();
    }

    function updateHud() {
      scoreEl.textContent = Math.floor(score);
      livesEl.textContent = lives;
      levelEl.textContent = level;
    }

    function spawnObstacle() {
      const size = 30 + Math.random() * 30;
      obstacles.push({
        x: Math.random() * (canvas.width - size),
        y: -size,
        size,
        speed: 120 + level * 35 + Math.random() * 20,
        wobble: Math.random() * Math.PI * 2,
        wobbleSpeed: 1 + Math.random() * 2
      });
    }

    function updateObstacles(delta) {
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += obs.speed * delta;
        obs.wobble += obs.wobbleSpeed * delta;
        obs.x += Math.sin(obs.wobble) * 40 * delta;

        if (obs.y > canvas.height + obs.size) {
          obstacles.splice(i, 1);
          score += 12;
        }
      }
    }

    function drawObstacles() {
      ctx.fillStyle = '#ff6a8e';
      obstacles.forEach(obs => {
        const gradient = ctx.createRadialGradient(
          obs.x + obs.size / 2,
          obs.y + obs.size / 2,
          obs.size * 0.1,
          obs.x + obs.size / 2,
          obs.y + obs.size / 2,
          obs.size / 1.2
        );
        gradient.addColorStop(0, '#ffe1ec');
        gradient.addColorStop(0.45, '#ff7a99');
        gradient.addColorStop(1, '#ff296d');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.ellipse(obs.x + obs.size / 2, obs.y + obs.size / 2, obs.size * 0.55, obs.size * 0.7, 0, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawPlayer() {
      const { x, y, width, height } = player;
      ctx.fillStyle = player.color;
      ctx.beginPath();
      ctx.moveTo(x + width / 2, y);
      ctx.lineTo(x, y + height);
      ctx.lineTo(x + width, y + height);
      ctx.closePath();
      ctx.fill();

      ctx.fillStyle = '#0b1d2d';
      ctx.fillRect(x + width / 2 - 6, y + height - 6, 12, 8);
    }

    function movePlayer(delta) {
      if (keys.ArrowLeft) {
        player.x -= player.speed * delta;
      }
      if (keys.ArrowRight) {
        player.x += player.speed * delta;
      }
      player.x = Math.max(6, Math.min(canvas.width - player.width - 6, player.x));
    }

    function checkCollisions() {
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        if (
          player.x < obs.x + obs.size &&
          player.x + player.width > obs.x &&
          player.y < obs.y + obs.size &&
          player.y + player.height > obs.y
        ) {
          obstacles.splice(i, 1);
          lives -= 1;
          score = Math.max(0, score - 50);
          flashOverlay('¡Impacto!', 'Has chocado con un meteorito. ¡Cuidado!');
          if (lives <= 0) {
            endGame();
          }
        }
      }
    }

    function flashOverlay(title, text) {
      overlayTitle.textContent = title;
      overlayText.textContent = text;
      overlay.setAttribute('aria-hidden', 'false');
      overlay.classList.add('is-visible');
      setTimeout(() => {
        if (running) {
          overlay.classList.remove('is-visible');
          overlay.setAttribute('aria-hidden', 'true');
        }
      }, 800);
    }

    function endGame() {
      running = false;
      overlayTitle.textContent = 'Fin de la partida';
      overlayText.textContent = `Puntuación final: ${Math.floor(score)}. Pulsa «Iniciar partida» para intentarlo de nuevo.`;
      overlay.classList.add('is-visible');
      overlay.setAttribute('aria-hidden', 'false');
      btnStart.disabled = false;
      btnStart.textContent = 'Jugar otra vez';
    }

    function updateStars(delta) {
      particles.forEach(star => {
        star.y += star.speed * delta;
        if (star.y > canvas.height) {
          star.y = -4;
          star.x = Math.random() * canvas.width;
        }
      });
    }

    function drawStars() {
      ctx.fillStyle = '#0a1229';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#9ecbff';
      particles.forEach(star => {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function update(timestamp) {
      if (!running) return;

      if (!lastTime) lastTime = timestamp;
      const delta = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      movePlayer(delta);
      updateStars(delta);
      updateObstacles(delta);
      checkCollisions();

      score += delta * 40;
      level = Math.min(9, 1 + Math.floor(score / 160));
      spawnTimer += delta * 1000;
      const targetInterval = Math.max(280, 900 - level * 70);
      if (spawnTimer >= targetInterval) {
        spawnObstacle();
        spawnTimer = 0;
      }

      updateHud();
      draw();

      requestAnimationFrame(update);
    }

    function draw() {
      drawStars();
      drawObstacles();
      drawPlayer();
    }

    btnStart.addEventListener('click', () => {
      resetGame();
      overlay.classList.remove('is-visible');
      overlay.setAttribute('aria-hidden', 'true');
      btnStart.disabled = true;
      btnStart.textContent = '¡Suerte!';
      running = true;
      lastTime = 0;
      requestAnimationFrame(update);
    });

    window.addEventListener('keydown', e => {
      if (e.key in keys) {
        keys[e.key] = true;
        e.preventDefault();
      }
    }, { passive: false });

    window.addEventListener('keyup', e => {
      if (e.key in keys) {
        keys[e.key] = false;
        e.preventDefault();
      }
    }, { passive: false });

    initStars();
    draw();
    overlay.classList.add('is-visible');
  </script>
</body>
</html>
